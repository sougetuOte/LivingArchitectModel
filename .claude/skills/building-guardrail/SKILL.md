---
name: building-guardrail
description: |
  BUILDINGフェーズでの作業時に自動適用するガードレール。
  TDD実装サイクルを強制し、仕様書とコードの同期を保証する。
  .claude/current-phase.md が BUILDING の場合、または
  /building コマンド実行後のセッションで適用される。
---

# BUILDINGフェーズ ガードレール

## 目的

このスキルは、BUILDINGフェーズにおいて TDD サイクルを厳守させ、仕様書とコードの同期を保証するためのガードレールを提供する。

## 適用条件

以下のいずれかに該当する場合、このスキルを適用する:

- `.claude/current-phase.md` の内容が `BUILDING` である
- ユーザーが実装、コーディング、テスト作成について作業している
- `src/` ディレクトリへの変更を求められている

## 必須事項（MUST）

1. **仕様書の事前確認**
   - 実装開始前に `docs/specs/` の対応仕様を読み込む
   - 仕様が存在しない場合は警告を表示

2. **TDDサイクルの厳守**
   - Step 1: 失敗するテストを先に書く（Red）
   - Step 2: テストを通す最小限のコードを実装（Green）
   - Step 3: リファクタリング（Refactor）
   - Step 4: 次のサイクルへ

3. **ドキュメント同期**
   - コード変更時は対応ドキュメントも同時更新
   - Atomic Commit の原則を守る

4. **サイクル完了報告**
   - 1つのRed-Green-Refactorサイクル完了ごとにユーザーに報告

## 禁止事項（MUST NOT）

1. **仕様なし実装**
   - 対応する仕様書がない状態での実装開始
   - 「後で仕様書を書く」という約束での先行実装

2. **テストなし実装**
   - テストを書かずに本実装を進める
   - 「動いたからOK」での完了宣言

3. **ドキュメント未更新のコミット**
   - コードだけ変更してドキュメントを更新しない

## 警告義務

### 仕様書不在時

```
⚠️ 仕様書警告

対応する仕様書が見つかりません。

選択肢:
1. /planning で仕様書を先に作成する
2. 仕様書のパスを指定する
3. 「仕様書なしで続行」と明示する（非推奨）

どちらを選びますか？
```

### テストスキップ要求時

```
⚠️ TDD警告

テストなしでの実装は BUILDING フェーズのルールに反します。

選択肢:
1. テストを先に書く（推奨）
2. テスト観点を列挙してから実装する
3. 「テストなしで続行」と明示する（非推奨）

どちらを選びますか？
```

## TDDサイクル詳細（t-wada style）

### Red フェーズ

```markdown
## 現在: Red フェーズ

目標: 失敗するテストを書く

チェックリスト:
- [ ] テスト対象の仕様を確認した
- [ ] テストファイルを作成した
- [ ] テストを実行して失敗を確認した
- [ ] 失敗メッセージが仕様を表現している

次のステップ: Green フェーズへ
```

### Green フェーズ

```markdown
## 現在: Green フェーズ

目標: テストを通す最小限のコードを書く

チェックリスト:
- [ ] 最小限の実装を行った
- [ ] テストがパスした
- [ ] 余計な機能を追加していない

次のステップ: Refactor フェーズへ
```

### Refactor フェーズ

```markdown
## 現在: Refactor フェーズ

目標: コードを改善する（テストは常にパス）

チェックリスト:
- [ ] 重複を排除した
- [ ] 可読性を向上させた
- [ ] テストが引き続きパスしている
- [ ] 対応ドキュメントを更新した

次のステップ: 次のサイクル or 完了報告
```

## サイクル完了報告テンプレート

```markdown
## TDDサイクル完了報告

### 実装内容
- 機能: [機能名]
- 対応仕様: `docs/specs/[ファイル名].md`

### テスト
- ファイル: `[テストファイルパス]`
- ケース数: X件
- 結果: 全パス ✓

### 実装
- ファイル: `[実装ファイルパス]`
- 変更行数: +X / -Y

### ドキュメント更新
- [ ] 仕様書: 更新不要 / 更新済み
- [ ] ADR: 更新不要 / 更新済み

### 次のアクション
1. [次のタスク]
```

## 参照ドキュメント

- `docs/internal/02_DEVELOPMENT_FLOW.md` (Phase 2)
- `docs/internal/03_QUALITY_STANDARDS.md`
