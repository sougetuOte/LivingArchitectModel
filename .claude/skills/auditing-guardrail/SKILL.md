---
name: auditing-guardrail
description: |
  AUDITINGフェーズでの作業時に自動適用するガードレール。
  コード品質、ドキュメント整合性、アーキテクチャ健全性を検証する。
  .claude/current-phase.md が AUDITING の場合、または
  /auditing コマンド実行後のセッションで適用される。
---

# AUDITINGフェーズ ガードレール

## 目的

このスキルは、AUDITINGフェーズにおいて品質監査を体系的に実施し、技術的負債の蓄積を防ぐためのガードレールを提供する。

## 適用条件

以下のいずれかに該当する場合、このスキルを適用する:

- `.claude/current-phase.md` の内容が `AUDITING` である
- ユーザーがレビュー、監査、リファクタリングについて作業している
- コードベース全体の品質確認を求められている

## 必須事項（MUST）

1. **体系的な監査**
   - チェックリストに基づく網羅的な確認
   - 発見事項の重要度分類（Critical/Warning/Info）

2. **3 Agents Model の適用**
   - 改善提案には Affirmative/Critical/Mediator の視点を適用
   - 特に Critical Agent によるリスク指摘を重視

3. **ドキュメント整合性確認**
   - `docs/specs/` と実装の一致確認
   - `docs/adr/` の決定事項が反映されているか確認

4. **改善提案の根拠明示**
   - なぜ問題なのかを説明
   - どう改善すべきかを具体的に提示

## 監査チェックリスト

### コード品質

```markdown
## コード品質チェック

### 命名・可読性
- [ ] 変数名が意図を表現している
- [ ] 関数名が動作を表現している
- [ ] コメントが「なぜ」を説明している

### 構造・設計
- [ ] 単一責任原則を守っている
- [ ] 適切な抽象化レベル
- [ ] 依存関係が明確

### エラー処理
- [ ] エラーケースが網羅されている
- [ ] エラーメッセージが有用
- [ ] 適切なログ出力

### セキュリティ
- [ ] 入力値の検証
- [ ] 認証・認可の確認
- [ ] 機密情報の取り扱い

### パフォーマンス
- [ ] N+1クエリの有無
- [ ] 不要な再計算
- [ ] メモリリークの可能性
```

### ドキュメント整合性

```markdown
## ドキュメント整合性チェック

### docs/specs/
- [ ] 全ての実装機能に対応する仕様が存在
- [ ] 仕様と実装の差異がない
- [ ] 受け入れ条件が最新

### docs/adr/
- [ ] アーキテクチャ決定が記録されている
- [ ] 決定事項が実装に反映されている
- [ ] 却下された選択肢も記録されている

### docs/tasks/
- [ ] タスク状態が最新
- [ ] 完了タスクがクローズされている
- [ ] 残タスクの優先順位が明確
```

### アーキテクチャ健全性

```markdown
## アーキテクチャ健全性チェック

### 依存関係
- [ ] 循環依存がない
- [ ] レイヤー違反がない
- [ ] 外部依存が適切

### モジュール境界
- [ ] 責務が明確
- [ ] インターフェースが安定
- [ ] 内部実装が隠蔽されている

### 技術的負債
- [ ] TODO/FIXME の棚卸し
- [ ] 非推奨APIの使用
- [ ] テストカバレッジの低い領域
```

## 監査レポートテンプレート

```markdown
# 監査レポート

**対象**: [ファイル/ディレクトリ]
**実施日**: [日付]
**監査者**: Claude ([AUDITING] モード)

## エグゼクティブサマリー

| 重要度 | 件数 |
|--------|------|
| Critical | X件 |
| Warning | X件 |
| Info | X件 |

**総合評価**: [A/B/C/D]

## Critical Issues

### [CRIT-001] [タイトル]
- **場所**: `[ファイルパス:行番号]`
- **内容**: [問題の説明]
- **影響**: [影響範囲]
- **推奨対応**: [具体的な修正案]

## Warnings

### [WARN-001] [タイトル]
- **場所**: `[ファイルパス]`
- **内容**: [問題の説明]
- **推奨対応**: [改善案]

## Info

### [INFO-001] [タイトル]
- **内容**: [観察事項]
- **提案**: [改善の余地]

## ドキュメント同期状況

| ドキュメント | 状態 | 備考 |
|-------------|------|------|
| docs/specs/ | ✓/✗ | |
| docs/adr/ | ✓/✗ | |
| docs/tasks/ | ✓/✗ | |

## 推奨アクション

### 即時対応（Critical）
1. [アクション]

### 短期対応（Warning）
1. [アクション]

### 中長期対応（改善）
1. [アクション]

## 3 Agents Analysis

**[Affirmative]**:
- [良い点、維持すべき点]

**[Critical]**:
- [リスク、懸念点]

**[Mediator]**:
- [バランスを取った推奨]
```

## Context Compression

セッションが長期化した場合、以下を提案する:

```
📋 コンテキスト圧縮の提案

セッションが長くなっています。
以下の情報を docs/memos/ に書き出してリセットすることを推奨します:

- 現在の監査状況
- 発見された問題のサマリー
- 未完了のチェック項目

書き出しを実行しますか？
```

## 参照ドキュメント

- `docs/internal/03_QUALITY_STANDARDS.md`
- `docs/internal/02_DEVELOPMENT_FLOW.md` (Phase 3)
- `docs/internal/06_DECISION_MAKING.md`
